<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGMH å¤§è…¸ç›´è…¸ç™Œè¨ºç™‚æŒ‡å¼•å°å¹«æ‰‹ (2025æ•™å­¸ç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --accent-color: #e8f0fe;
            --text-color: #333;
            --bg-color: #f4f6f8;
            /* Flowchart Colors */
            --box-blue: #ebf8ff; --border-blue: #4299e1;
            --box-green: #f0fff4; --border-green: #48bb78;
            --box-orange: #fffaf0; --border-orange: #ed8936;
            --box-red: #fff5f5; --border-red: #f56565;
            --box-purple: #faf5ff; --border-purple: #9f7aea;
        }
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; line-height: 1.6; color: var(--text-color); margin: 0; background: var(--bg-color); }
        
        /* Layout */
        header { background: var(--primary-color); color: white; padding: 1rem; text-align: center; }
        .container { max-width: 95%; margin: 15px auto; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); min-height: 85vh;}
        
        /* Tabs */
        .tabs { display: flex; flex-wrap: wrap; border-bottom: 2px solid #ddd; margin-bottom: 20px; gap: 5px; }
        .tab-btn { padding: 10px 10px; cursor: pointer; border: none; background: #f8f9fa; border-radius: 5px 5px 0 0; font-size: 15px; font-weight: bold; color: #666; transition: 0.3s; flex-grow: 1; min-width: 100px; }
        .tab-btn:hover { background: #e2e6ea; }
        .tab-btn.active { background: var(--primary-color); color: white; }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Form Elements */
        .form-group { margin-bottom: 15px; padding: 15px; background: var(--accent-color); border-radius: 8px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #004494; }
        select, input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        button.action-btn { background: var(--primary-color); color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; font-weight: bold; }
        button.action-btn:hover { background: #004494; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Results Area */
        #result-box, #protocol-result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-left: 5px solid var(--primary-color); background: #fff; display: none; border-radius: 4px; }
        .protocol-card { border-bottom: 1px solid #eee; padding: 12px 0; }
        .protocol-title { font-weight: bold; color: #000; font-size: 1.1em; display: flex; justify-content: space-between; align-items: center; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; color: white; white-space: nowrap; margin-left: 5px;}
        .badge-self { background-color: #dc3545; } 
        .badge-ins { background-color: #28a745; }

        /* Rationale Box */
        .rationale-box { background-color: #fff8e1; border: 1px solid #ffe0b2; padding: 10px; margin-top: 10px; border-radius: 5px; font-size: 0.9em; color: #8d6e63; }
        .rationale-title { font-weight: bold; display: block; margin-bottom: 5px; color: #e65100; }

        /* Knowledge Base Accordion */
        .kb-item { margin-bottom: 10px; border: 1px solid #eee; border-radius: 5px; overflow: hidden; }
        .kb-header { background: #f1f8ff; padding: 15px; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .kb-header:hover { background: #e1f0ff; }
        .kb-content { display: none; padding: 15px; background: white; border-top: 1px solid #eee; }
        .kb-content.open { display: block; }
        .kb-tag { font-size: 0.8em; padding: 2px 6px; background: #e2e8f0; border-radius: 4px; color: #4a5568; margin-right: 10px; }

        /* ================= Flowchart Styles ================= */
        .flowchart-wrapper { 
            overflow: hidden; 
            padding-bottom: 20px; 
            text-align: center; 
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fdfdfd;
            position: relative;
        }
        
        .zoom-controls {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: #eee;
            padding: 5px;
            border-radius: 20px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .zoom-label { font-size: 0.85em; color: #555; font-weight: bold; }
        input[type=range] { width: 150px; cursor: pointer; }

        .scale-container {
            transform-origin: top center;
            transition: transform 0.2s ease-out;
            width: fit-content;
            margin: 0 auto;
        }

        .legend { margin-bottom: 10px; font-size: 0.9em; color: #666; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .legend span { display: inline-block; width: 12px; height: 12px; margin-right: 3px; border-radius: 2px; vertical-align: middle; }
        
        .node {
            background: white; border: 2px solid #a0aec0; padding: 8px 10px; border-radius: 6px;
            cursor: pointer; text-align: center; font-weight: bold; position: relative; font-size: 0.9rem;
            transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: inline-block; margin: 5px; min-width: 100px; vertical-align: top;
        }
        .node:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 5px 10px rgba(0,0,0,0.15); z-index: 5; }
        
        .n-start { border-color: var(--border-blue); background: var(--box-blue); color: #2b6cb0; }
        .n-decision { border-color: var(--border-orange); background: var(--box-orange); color: #c05621; }
        .n-action { border-color: var(--border-green); background: var(--box-green); color: #2f855a; }
        .n-critical { border-color: var(--border-red); background: var(--box-red); color: #c53030; }
        .n-therapy { border-color: var(--border-purple); background: var(--box-purple); color: #6b46c1; }

        .branches { display: flex; justify-content: center; position: relative; padding-top: 15px; }
        .branches::before { content: ''; position: absolute; top: 0; left: 50%; width: 2px; height: 15px; background: #cbd5e0; }
        .branch { padding: 0 5px; position: relative; }
        .branch::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: #cbd5e0; }
        .branch:first-child::before { left: 50%; }
        .branch:last-child::before { right: 50%; }
        .branch:only-child::before { display: none; }
        .branch::after { content: ''; position: absolute; top: 0; left: 50%; width: 2px; height: 15px; background: #cbd5e0; }

        .details-popover {
            display: none; margin-top: 8px; padding: 8px; background: #fff;
            border: 1px solid #ccc; border-radius: 4px; font-size: 0.8em;
            text-align: left; color: #444; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .details-popover.show { display: block; }
        .details-popover ul { padding-left: 15px; margin: 5px 0; }

        @media (max-width: 768px) {
            .tabs { flex-direction: row; }
            .tab-btn { font-size: 0.9em; padding: 8px; }
        }
    </style>
</head>
<body>

<header>
    <h1>CGMH è…¸ç™ŒæŒ‡å¼•å°å¹«æ‰‹</h1>
    <p style="font-size:0.9em; margin-top:5px;">2025/03/26 ä¿®è¨‚ç‰ˆ | è‡¨åºŠæ±ºç­– & æ•™å­¸è¼”åŠ©</p>
</header>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('flowchart')">ğŸ—ºï¸ å…¨å±€æµç¨‹</button>
        <button class="tab-btn" onclick="openTab('mcrc')">ğŸ§¬ mCRC æ±ºç­–</button>
        <button class="tab-btn" onclick="openTab('protocols')">ğŸ’Š è™•æ–¹æŸ¥è©¢</button>
        <button class="tab-btn" onclick="openTab('knowledge')">ğŸ“š æ±ºç­–åŸç†</button>
    </div>

    <!-- Tab 1: Global Flowchart -->
    <div id="flowchart" class="tab-content active">
        <h2 style="text-align:center;">å¤§è…¸ç›´è…¸ç™Œå…¨æ™¯é‘‘åˆ¥æµç¨‹</h2>
        
        <div class="zoom-controls">
            <span class="zoom-label">ğŸ” ç¸®æ”¾:</span>
            <input type="range" min="0.4" max="1.5" step="0.1" value="1.0" id="zoomRange" oninput="updateZoom(this.value)">
            <span class="zoom-label" id="zoomValue">100%</span>
        </div>

        <div class="legend">
            <div><span style="background:var(--box-blue)"></span>èµ·å§‹</div>
            <div><span style="background:var(--box-orange)"></span>æ±ºç­–</div>
            <div><span style="background:var(--box-green)"></span>è™•ç½®</div>
            <div><span style="background:var(--box-red)"></span>mCRC</div>
            <div><span style="background:var(--box-purple)"></span>è—¥ç‰©</div>
        </div>
        
        <div class="flowchart-wrapper">
            <div class="scale-container" id="chartContainer">
                <div class="branches" style="padding-top:0;">
                    <div class="branch">
                        <div class="node n-start" onclick="toggleNode('d1')">ç–‘ä¼¼/ç¢ºè¨º CRC<div id="d1" class="details-popover">è«‹é»é¸ä¸‹æ–¹åˆ†æ”¯<br>é€²å…¥ä¸åŒæœŸåˆ¥æ±ºç­–</div></div>
                        <div class="branches">
                            <!-- Branch: Polyp -->
                            <div class="branch">
                                <div class="node n-decision" onclick="toggleNode('d2')">æ—©æœŸç—…ç¶ (Polyp)<div id="d2" class="details-popover">æŒ‡å¼• p.7, 18</div></div>
                                <div class="branches"><div class="branch"><div class="node n-action" onclick="toggleNode('d3')">å…§è¦–é¡åˆ‡é™¤<div id="d3" class="details-popover">Excision</div></div>
                                    <div class="branches"><div class="branch"><div class="node n-critical" onclick="toggleNode('d4')">é¢¨éšªè©•ä¼° (Risk)<div id="d4" class="details-popover"><strong>High Risk?</strong><br>éœ€è€ƒæ…®æ ¹æ²»æ€§æ‰‹è¡“</div></div></div></div>
                                </div></div>
                            </div>
                            <!-- Branch: Colon -->
                            <div class="branch">
                                <div class="node n-decision">å±€éƒ¨å¤§è…¸ç™Œ</div>
                                <div class="branches"><div class="branch"><div class="node n-action">æ‰‹è¡“åˆ‡é™¤</div>
                                    <div class="branches"><div class="branch"><div class="node n-therapy" onclick="toggleNode('d5')">è¼”åŠ©åŒ–ç™‚è©•ä¼°<div id="d5" class="details-popover">Stage III å¿…åš<br>High Risk II è€ƒæ…®</div></div></div></div>
                                </div></div>
                            </div>
                            <!-- Branch: Rectal -->
                            <div class="branch">
                                <div class="node n-decision" onclick="toggleNode('d6')">å±€éƒ¨ç›´è…¸ç™Œ<div id="d6" class="details-popover">é—œéµ: MRI CRM<br>(åˆ‡é™¤é‚Šç•Œ)</div></div>
                                <div class="branches"><div class="branch"><div class="node n-therapy" onclick="toggleNode('d7')">æ–°è¼”åŠ©æ²»ç™‚ (Neo)<div id="d7" class="details-popover">CRM+ éœ€åš CCRT<br>ç¸®å°è…«ç˜¤ç¯„åœ</div></div>
                                    <div class="branches"><div class="branch"><div class="node n-action">TME æ‰‹è¡“</div></div></div>
                                </div></div>
                            </div>
                            <!-- Branch: mCRC -->
                            <div class="branch">
                                <div class="node n-critical" onclick="toggleNode('d8')">è½‰ç§»æ€§ (mCRC)<div id="d8" class="details-popover">æŒ‡å¼• p.23-26<br>åŸºå› å°å‘æ²»ç™‚</div></div>
                                <div class="branches">
                                    <div class="branch"><div class="node n-action">å¯åˆ‡é™¤: æ‰‹è¡“</div></div>
                                    <div class="branch"><div class="node n-therapy">ä¸å¯åˆ‡é™¤: è—¥ç‰©</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 2: mCRC Wizard -->
    <div id="mcrc" class="tab-content">
        <h2>ğŸ§¬ mCRC åŸºå› å°å‘ç”¨è—¥æ±ºç­–</h2>
        <p>ä¾æ“š PDF ç¬¬ 23-26 é ï¼Œç³»çµ±å°‡ä¾æ“šåŸºå› å‹æ…‹æä¾›å»ºè­°èˆ‡<strong>è‡¨åºŠæ©Ÿè½‰è§£é‡‹</strong>ã€‚</p>
        
        <div class="form-group">
            <label>RAS Status (KRAS/NRAS):</label>
            <select id="ras-status">
                <option value="wt">Wild Type (é‡ç”Ÿå‹)</option>
                <option value="mt">Mutant (çªè®Šå‹)</option>
            </select>
        </div>

        <div class="form-group">
            <label>BRAF V600E Status:</label>
            <select id="braf-status">
                <option value="wt">Wild Type</option>
                <option value="mt">Mutation (V600E)</option>
            </select>
        </div>

        <div class="form-group">
            <label>MSI/MMR Status:</label>
            <select id="msi-status">
                <option value="mss">pMMR / MSS (å¾®è¡›æ˜Ÿç©©å®š)</option>
                <option value="msi-h">dMMR / MSI-H (é«˜åº¦ä¸ç©©å®š)</option>
            </select>
        </div>

        <button class="action-btn" onclick="checkTreatment()">å–å¾—å»ºè­°è™•æ–¹ & è‡¨åºŠåŸç†</button>

        <div id="result-box">
            <h3>ğŸ’Š å»ºè­°æ²»ç™‚æ–¹æ¡ˆï¼š</h3>
            <div id="treatment-content"></div>
            
            <div id="rationale-content" class="rationale-box">
                <!-- Rationale will appear here -->
            </div>
        </div>
    </div>

    <!-- Tab 3: Protocols -->
    <div id="protocols" class="tab-content">
        <h2>ğŸ’Š åŒ–ç™‚/æ¨™é¶è™•æ–¹æŸ¥è©¢</h2>
        <div style="display:flex; gap:10px;">
            <input type="text" id="search-input" placeholder="ä»£ç¢¼ (PCT2025) æˆ–é—œéµå­— (HIPEC)...">
            <button class="action-btn" style="width:auto; margin-top:0;" onclick="searchProtocol()">æœå°‹</button>
        </div>
        <div id="protocol-result"></div>
    </div>

    <!-- Tab 4: Knowledge Base (WHY?) -->
    <div id="knowledge" class="tab-content">
        <h2>ğŸ“š è‡¨åºŠæ±ºç­–ä¾æ“šèˆ‡åŸç† (Rationale)</h2>
        <p>é‡å°æŒ‡å¼•ä¸­é‡è¦æ±ºç­–é»çš„ç—…ç†èˆ‡è‡¨åºŠè§£é‡‹ï¼š</p>

        <div class="kb-item">
            <div class="kb-header" onclick="toggleKb(this)">
                <span>æ—©æœŸæ¯è‚‰ç‚ºä½•è¦è¿½åŠ æ‰‹è¡“? (High Risk Polyp)</span> <span>â–¼</span>
            </div>
            <div class="kb-content">
                <span class="kb-tag">Early Stage</span><span class="kb-tag">PDF p.7, 18</span>
                <p><strong>æ±ºç­–é»ï¼š</strong>ç•¶å…§è¦–é¡åˆ‡é™¤çš„æ¯è‚‰å«æœ‰ã€Œé«˜é¢¨éšªç‰¹å¾µã€æ™‚ï¼Œæ·‹å·´çµè½‰ç§» (LNM) çš„é¢¨éšªå¯èƒ½è¶…é 10%ï¼Œé«˜æ–¼æ‰‹è¡“æ­»äº¡ç‡ï¼Œæ•…å»ºè­°è¿½åŠ æ ¹æ²»æ€§æ‰‹è¡“ã€‚</p>
                <p><strong>å±éšªå› å­ (High Risk Features)ï¼š</strong></p>
                <ul>
                    <li><strong>Positive Margin:</strong> åˆ‡é™¤é‚Šç•Œæœ‰ç™Œç´°èƒï¼Œå¾©ç™¼ç‡æ¥µé«˜ã€‚</li>
                    <li><strong>Lymphovascular Invasion (LVI):</strong> ç™Œç´°èƒä¾µå…¥æ·‹å·´ç®¡/è¡€ç®¡ï¼Œæ˜¯è½‰ç§»çš„ç¬¬ä¸€æ­¥ã€‚</li>
                    <li><strong>Poorly Differentiated:</strong> åˆ†åŒ–ä¸è‰¯ä»£è¡¨è…«ç˜¤æƒ¡æ€§åº¦é«˜ï¼Œæ“´æ•£å¿«ã€‚</li>
                    <li><strong>SM invasion â‰¥ 1mm:</strong> ä¾µçŠ¯é»è†œä¸‹å±¤éæ·±ï¼Œæ¥è§¸æ·‹å·´ç®¡æ©Ÿæœƒå¤§å¢ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="kb-item">
            <div class="kb-header" onclick="toggleKb(this)">
                <span>ç›´è…¸ç™Œ CRM ç‚ºä½•æ±ºå®šæ²»ç™‚è·¯å¾‘?</span> <span>â–¼</span>
            </div>
            <div class="kb-content">
                <span class="kb-tag">Rectal Cancer</span><span class="kb-tag">PDF p.17</span>
                <p><strong>CRM (Circumferential Resection Margin):</strong> ç’°å‘¨åˆ‡é™¤é‚Šç•Œï¼Œæ˜¯ç›´è…¸ç™Œå±€éƒ¨å¾©ç™¼æœ€å¼·çš„é æ¸¬å› å­ã€‚</p>
                <ul>
                    <li><strong>CRM Involved (é™½æ€§):</strong> MRI é¡¯ç¤ºè…«ç˜¤è·é›¢ç›´è…¸ç³»è†œç­‹è†œ (Mesorectal fascia) å°æ–¼ 1mmã€‚è‹¥ç›´æ¥æ‰‹è¡“ï¼Œæ¥µé«˜æ©Ÿç‡æœƒæ®˜ç•™ç™Œç´°èƒ (R1 resection)ã€‚</li>
                    <li><strong>è™•ç½®é‚è¼¯ï¼š</strong> å¿…é ˆå…ˆé€²è¡Œ <strong>æ–°è¼”åŠ©æ”¾åŒ–ç™‚ (CCRT)</strong> æˆ– <strong>TNT</strong>ï¼Œåˆ©ç”¨æ”¾å°„ç·šä½¿è…«ç˜¤ç¸®å° (Downsizing)ï¼Œè®“é‚Šç•Œè®Šå›ä¹¾æ·¨ (Clear)ï¼Œæ‰èƒ½é€²è¡Œæ‰‹è¡“ (TME)ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="kb-item">
            <div class="kb-header" onclick="toggleKb(this)">
                <span>ç‚ºä»€éº¼ mCRC è¦åš RAS/BRAF æª¢æ¸¬?</span> <span>â–¼</span>
            </div>
            <div class="kb-content">
                <span class="kb-tag">mCRC</span><span class="kb-tag">Pathology</span>
                <p>é€™æ˜¯æ±ºå®šæ˜¯å¦ä½¿ç”¨ <strong>æŠ— EGFR æ¨™é¶è—¥ç‰© (Cetuximab/Panitumumab)</strong> çš„é—œéµã€‚</p>
                <ul>
                    <li><strong>EGFR è·¯å¾‘åŸç†ï¼š</strong> EGFR å—é«”æ´»åŒ–å¾Œï¼Œæœƒå‚³è¨Šè™Ÿçµ¦ RAS â†’ BRAF â†’ ä¿ƒé€²ç´°èƒåˆ†è£‚ã€‚</li>
                    <li><strong>RAS çªè®Š (Mutant):</strong> ä¸‹æ¸¸çš„ RAS è‡ªå·±æœƒä¸€ç›´ã€Œé–‹è‘—ã€ç™¼é€è¨Šè™Ÿï¼Œä¸ç®¡ä¸Šæ¸¸æœ‰æ²’æœ‰é˜»æ–· EGFR éƒ½æ²’ç”¨ã€‚<strong>æ‰€ä»¥ RAS çªè®Šè€…ï¼Œæ‰“ EGFR è—¥ç‰©ç„¡æ•ˆ (å¾’å¢å‰¯ä½œç”¨)ã€‚</strong></li>
                    <li><strong>BRAF V600E çªè®Š:</strong> é å¾Œæ¥µå·®çš„äºå‹ã€‚å–®ç”¨ EGFR æŠ‘åˆ¶åŠ‘æœƒå›  Feedback Loop å°è‡´å†æ´»åŒ–ï¼Œéœ€åˆä½µ BRAF æŠ‘åˆ¶åŠ‘ (å¦‚ Encorafenib) æ‰æœ‰æ•ˆæœ (Beacon trial)ã€‚</li>
                </ul>
            </div>
        </div>
        
         <div class="kb-item">
            <div class="kb-header" onclick="toggleKb(this)">
                <span>MSI-H ç‚ºä½•é¦–é¸å…ç–«æ²»ç™‚?</span> <span>â–¼</span>
            </div>
            <div class="kb-content">
                <span class="kb-tag">Immunotherapy</span><span class="kb-tag">dMMR</span>
                <p><strong>æ©Ÿè½‰è§£é‡‹ï¼š</strong></p>
                <ul>
                    <li><strong>dMMR (DNAéŒ¯é…ä¿®å¾©ç¼ºå¤±):</strong> è…«ç˜¤ç´°èƒç„¡æ³•ä¿®å¾© DNA éŒ¯èª¤ï¼Œå°è‡´ç´¯ç©å¤§é‡çªè®Š (High Tumor Mutational Burden, TMB-H)ã€‚</li>
                    <li><strong>æ–°æŠ—åŸ (Neoantigens):</strong> é€™äº›çªè®Šæœƒç”¢ç”Ÿå¤§é‡æ€ªç•°çš„è›‹ç™½è³ª (æŠ—åŸ)ï¼Œè®“å…ç–«ç³»çµ±å¾ˆå®¹æ˜“è¾¨è­˜å‡ºå®ƒå€‘æ˜¯ã€Œå£äººã€ã€‚</li>
                    <li><strong>Checkpoint Inhibitor:</strong> é€™ç¨®è…«ç˜¤é€šå¸¸æœƒåˆ©ç”¨ PD-L1 ä¾†ã€Œè¸©å‰è»Šã€æ¬ºé¨™å…ç–«ç´°èƒã€‚ä½¿ç”¨å…ç–«è—¥ç‰© (Keytruda/Opdivo) æ”¾é–‹å‰è»Šï¼Œå…ç–«ç´°èƒå°±èƒ½ç‹‚æ®ºé€™äº›é«˜çªè®Šçš„ç™Œç´°èƒã€‚</li>
                </ul>
            </div>
        </div>

    </div>

</div>

<script>
    // --- Data ---
    const protocols = [
        { code: "PCT2025-01", name: "Bevacizumab + mFOLFOX 6", type: "Palliative", status: "å¥ä¿ (äºŒç·š24é€±)", details: "Bevacizumab 5mg/kg + mFOLFOX6 Q2W. (2025æ–°å¢)" },
        { code: "ACT2010-6", name: "mFOLFOX 6", type: "Adjuvant", status: "å¥ä¿ (Stage III)", details: "Oxaliplatin 85mg/m2 + LV + 5-FU bolus + 5-FU infusion (46hr). Q2W x 12 cycles." },
        { code: "PCT2010-5", name: "HIPEC by Oxaliplatin", type: "Palliative", status: "å¥ä¿/è‡ªè²»", details: "<strong>è…¹è…”çŒæ³¨:</strong> Oxaliplatin 360~460 mg/m2 (Irrigation).<br><strong>IV (Optional):</strong> 5-FU 400mg/m2 + LV 20mg/m2.<br><strong>Pre-med:</strong> Dexamethasone 5mg + Palonosetron." },
        { code: "HIPEC-MMC", name: "HIPEC by Mitomycin C", type: "Palliative", status: "å¥ä¿/è‡ªè²»", details: "<strong>è…¹è…”çŒæ³¨:</strong> Mitomycin C 40mg Total.<br>(a) 30mg in Dialysate for 60 mins.<br>(b) 10mg in Dialysate for 30 mins." },
        { code: "ACT2021-01", name: "TEGAFOX", type: "Adjuvant", status: "éƒ¨åˆ†è‡ªè²»", details: "Oxaliplatin 85mg/m2 (è‡ªè²» D1) + UFT/LV (å¥ä¿ PO D1-5, 8-12). Q2W." },
        { code: "PCT2010-22", name: "Avastin + FOLFIRI", type: "Palliative", status: "è‡ªè²» / ä¸€ç·šå¥ä¿", details: "Bevacizumab 5mg/kg + Irinotecan + LV + 5-FU." },
        { code: "PCT2015-02", name: "Panitumumab", type: "Palliative", status: "è‡ªè²»", details: "6mg/kg IVF 60mins Q2W. å–®ç¨æˆ–æ­é…åŒ–ç™‚ (é™ RAS WT)." }
    ];

    // --- Logic ---
    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        
        // Button Highlight Logic
        const buttons = document.querySelectorAll('.tab-btn');
        if(tabId === 'flowchart') buttons[0].classList.add('active');
        if(tabId === 'mcrc') buttons[1].classList.add('active');
        if(tabId === 'protocols') buttons[2].classList.add('active');
        if(tabId === 'knowledge') buttons[3].classList.add('active');

        if(tabId === 'flowchart' && window.innerWidth < 768) {
            updateZoom(0.6); 
            document.getElementById('zoomRange').value = 0.6;
        }
    }

    function toggleNode(id) {
        const el = document.getElementById(id);
        const isShown = el.classList.contains('show');
        document.querySelectorAll('.details-popover').forEach(p => p.classList.remove('show'));
        if (!isShown) el.classList.add('show');
    }

    function toggleKb(header) {
        const content = header.nextElementSibling;
        content.classList.toggle('open');
    }

    function updateZoom(val) {
        document.getElementById('chartContainer').style.transform = `scale(${val})`;
        document.getElementById('zoomValue').innerText = Math.round(val * 100) + '%';
    }

    function checkTreatment() {
        const ras = document.getElementById('ras-status').value;
        const braf = document.getElementById('braf-status').value;
        const msi = document.getElementById('msi-status').value;
        let suggestions = [];
        let rationale = [];

        // Logic & Rationale
        if (msi === 'msi-h') {
            suggestions.push("âœ… <strong>Immunotherapy (é¦–é¸):</strong> Checkpoint Inhibitors (Pembrolizumab / Nivolumab Â± Ipilimumab)");
            rationale.push("ğŸ”¸ <strong>MSI-H æ©Ÿè½‰:</strong> è…«ç˜¤å…·æœ‰å¤§é‡çªè®ŠæŠ—åŸï¼Œå…ç–«æª¢æŸ¥é»æŠ‘åˆ¶åŠ‘æ•ˆæœé¡¯è‘—å„ªæ–¼å‚³çµ±åŒ–ç™‚ (PDF p.27)ã€‚");
        }

        if (ras === 'wt' && braf === 'wt') {
            suggestions.push("âœ… <strong>Doublet Chemo + Anti-EGFR:</strong> FOLFOX/FOLFIRI + Cetuximab/Panitumumab (å·¦å´å¤§è…¸å„ªå…ˆ)");
            suggestions.push("âœ… <strong>Doublet Chemo + Bevacizumab:</strong> FOLFOX/FOLFIRI + Bevacizumab");
            rationale.push("ğŸ”¹ <strong>RAS/BRAF é‡ç”Ÿå‹:</strong> EGFR ä¸‹æ¸¸è·¯å¾‘å®Œæ•´ï¼Œæ•…ä½¿ç”¨ Cetuximab/Panitumumab é˜»æ–· EGFR å—é«”æœ‰æ•ˆã€‚");
        } else if (ras === 'mt') {
            suggestions.push("â›” <strong>Anti-EGFR ä¸é©ç”¨</strong> (ç¦ç”¨ Cetuximab/Panitumumab)");
            suggestions.push("âœ… <strong>Chemo + Bevacizumab:</strong> FOLFOX/FOLFIRI + Bevacizumab");
            suggestions.push("âœ… <strong>Intensive:</strong> FOLFOXIRI + Bevacizumab (è‹¥é«”èƒ½è¨±å¯)");
            rationale.push("ğŸ”» <strong>RAS çªè®Š:</strong> å°è‡´ä¸‹æ¸¸è¨Šè™ŸæŒçºŒæ´»åŒ–ï¼Œé€™æœƒè®“ä¸Šæ¸¸çš„ EGFR æŠ‘åˆ¶åŠ‘ç„¡æ•ˆåŒ–ã€‚æ‡‰æ”¹ç”¨æŠ—è¡€ç®¡æ–°ç”Ÿè—¥ç‰© (Bevacizumab)ã€‚");
        }

        if (braf === 'mt') {
             suggestions.push("âš ï¸ <strong>BRAF V600E Mutation:</strong> é å¾Œè¼ƒå·®");
             suggestions.push("âœ… <strong>First Line:</strong> FOLFOXIRI + Bevacizumab");
             suggestions.push("âœ… <strong>Second/Third Line:</strong> Encorafenib + Cetuximab (Beacon Regimen)");
             rationale.push("ğŸ”¸ <strong>BRAF V600E:</strong> æ¥µå…·ä¾µè¥²æ€§ã€‚éœ€ä½¿ç”¨å¼·åŠ›åŒ–ç™‚ (Triplet) æˆ–é‡å° BRAF ç¯€é»çš„é›™é‡æŠ‘åˆ¶ (Beacon)ã€‚");
        }

        if (suggestions.length === 0) suggestions.push("å»ºè­°æ¡è¡Œ Best Supportive Care æˆ–åƒèˆ‡è‡¨åºŠè©¦é©—ã€‚");

        document.getElementById('treatment-content').innerHTML = `<ul>${suggestions.map(s => `<li>${s}</li>`).join('')}</ul>`;
        document.getElementById('rationale-content').innerHTML = `<span class="rationale-title">ğŸ’¡ è‡¨åºŠæ±ºç­–åŸç†ï¼š</span>${rationale.join('<br>')}`;
        document.getElementById('result-box').style.display = 'block';
    }

    function searchProtocol() {
        const query = document.getElementById('search-input').value.toLowerCase();
        if(!query) return;
        const results = protocols.filter(p => 
            p.code.toLowerCase().includes(query) || 
            p.name.toLowerCase().includes(query) ||
            p.details.toLowerCase().includes(query)
        );
        const container = document.getElementById('protocol-result');
        container.style.display = 'block';
        if (results.length === 0) {
            container.innerHTML = "<p>æ‰¾ä¸åˆ°ç¬¦åˆçš„è™•æ–¹ã€‚</p>";
            return;
        }
        container.innerHTML = results.map(p => `
            <div class="protocol-card">
                <div class="protocol-title">${p.code} - ${p.name} 
                    <span class="badge ${p.status.includes('è‡ªè²»') ? 'badge-self' : 'badge-ins'}">${p.status}</span>
                </div>
                <div style="font-size:0.9em; margin-top:5px; color:#555;">${p.details}</div>
            </div>
        `).join('');
    }
</script>

</body>
</html>
