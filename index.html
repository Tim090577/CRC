<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGMH å¤§è…¸ç›´è…¸ç™Œè¨ºç™‚æŒ‡å¼•å°å¹«æ‰‹ (2025ç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --accent-color: #e8f0fe;
            --text-color: #333;
            --bg-color: #f4f6f8;
            /* Flowchart Colors */
            --box-blue: #ebf8ff; --border-blue: #4299e1;
            --box-green: #f0fff4; --border-green: #48bb78;
            --box-orange: #fffaf0; --border-orange: #ed8936;
            --box-red: #fff5f5; --border-red: #f56565;
            --box-purple: #faf5ff; --border-purple: #9f7aea;
        }
        body { font-family: "Microsoft JhengHei", Arial, sans-serif; line-height: 1.6; color: var(--text-color); margin: 0; background: var(--bg-color); }
        
        /* Layout */
        header { background: var(--primary-color); color: white; padding: 1rem; text-align: center; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); min-height: 80vh;}
        
        /* Tabs */
        .tabs { display: flex; flex-wrap: wrap; border-bottom: 2px solid #ddd; margin-bottom: 20px; gap: 5px; }
        .tab-btn { padding: 10px 15px; cursor: pointer; border: none; background: #f8f9fa; border-radius: 5px 5px 0 0; font-size: 15px; font-weight: bold; color: #666; transition: 0.3s; flex-grow: 1; }
        .tab-btn:hover { background: #e2e6ea; }
        .tab-btn.active { background: var(--primary-color); color: white; }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Form Elements */
        .form-group { margin-bottom: 15px; padding: 15px; background: var(--accent-color); border-radius: 8px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #004494; }
        select, input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        button.action-btn { background: var(--primary-color); color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; font-weight: bold; }
        button.action-btn:hover { background: #004494; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Results Area */
        #result-box, #protocol-result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-left: 5px solid var(--primary-color); background: #fff; display: none; border-radius: 4px; }
        .protocol-card { border-bottom: 1px solid #eee; padding: 12px 0; }
        .protocol-title { font-weight: bold; color: #000; font-size: 1.1em; display: flex; justify-content: space-between; align-items: center; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; color: white; white-space: nowrap; }
        .badge-self { background-color: #dc3545; } 
        .badge-ins { background-color: #28a745; }

        /* ================= Flowchart Styles ================= */
        .flowchart-wrapper { overflow-x: auto; padding-bottom: 20px; text-align: center; }
        .legend { margin-bottom: 20px; font-size: 0.9em; color: #666; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .legend span { display: inline-block; width: 12px; height: 12px; margin-right: 5px; border-radius: 2px; }
        
        .node {
            background: white; border: 2px solid #a0aec0; padding: 10px 15px; border-radius: 8px;
            cursor: pointer; text-align: center; font-weight: bold; position: relative;
            transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: inline-block; margin: 10px; min-width: 120px; vertical-align: top;
        }
        .node:hover { transform: translateY(-3px); box-shadow: 0 5px 10px rgba(0,0,0,0.15); }
        
        /* Node Colors */
        .n-start { border-color: var(--border-blue); background: var(--box-blue); color: #2b6cb0; }
        .n-decision { border-color: var(--border-orange); background: var(--box-orange); color: #c05621; }
        .n-action { border-color: var(--border-green); background: var(--box-green); color: #2f855a; }
        .n-critical { border-color: var(--border-red); background: var(--box-red); color: #c53030; }
        .n-therapy { border-color: var(--border-purple); background: var(--box-purple); color: #6b46c1; }

        /* Lines */
        .branches { display: flex; justify-content: center; position: relative; padding-top: 20px; }
        .branches::before { content: ''; position: absolute; top: 0; left: 50%; width: 2px; height: 20px; background: #cbd5e0; }
        .branch { padding: 0 10px; position: relative; }
        .branch::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: #cbd5e0; }
        .branch:first-child::before { left: 50%; }
        .branch:last-child::before { right: 50%; }
        .branch:only-child::before { display: none; }
        .branch::after { content: ''; position: absolute; top: 0; left: 50%; width: 2px; height: 20px; background: #cbd5e0; }

        /* Popover Details */
        .details-popover {
            display: none; margin-top: 8px; padding: 10px; background: #fff;
            border: 1px solid #ccc; border-radius: 4px; font-size: 0.85em;
            text-align: left; color: #444; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .details-popover.show { display: block; }
        .details-popover ul { padding-left: 20px; margin: 5px 0; }

        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .branches { flex-direction: column; align-items: center; }
            .branches::before, .branch::before, .branch::after { display: none; }
            .branch { width: 100%; border-left: 3px solid #cbd5e0; margin-left: 20px; padding-left: 15px; padding-bottom: 20px;}
        }
    </style>
</head>
<body>

<header>
    <h1>CGMH è…¸ç™ŒæŒ‡å¼•å°å¹«æ‰‹</h1>
    <p>2025/03/26 ä¿®è¨‚ç‰ˆ | è‡¨åºŠæ±ºç­– & è™•æ–¹é€ŸæŸ¥</p>
</header>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('flowchart')">ğŸ—ºï¸ å…¨å±€æµç¨‹åœ–</button>
        <button class="tab-btn" onclick="openTab('mcrc')">ğŸ§¬ mCRC ç”¨è—¥æ±ºç­–</button>
        <button class="tab-btn" onclick="openTab('protocols')">ğŸ’Š è™•æ–¹æŸ¥è©¢</button>
        <button class="tab-btn" onclick="openTab('rectal')">ğŸ“‹ ç›´è…¸ç™Œé‡é»</button>
    </div>

    <!-- Tab 1: Global Flowchart -->
    <div id="flowchart" class="tab-content active">
        <h2 style="text-align:center;">å¤§è…¸ç›´è…¸ç™Œå…¨æ™¯é‘‘åˆ¥æµç¨‹</h2>
        <div class="legend">
            <div><span style="background:var(--box-blue)"></span>èµ·å§‹</div>
            <div><span style="background:var(--box-orange)"></span>æ±ºç­–</div>
            <div><span style="background:var(--box-green)"></span>è™•ç½®</div>
            <div><span style="background:var(--box-red)"></span>mCRC</div>
            <div><span style="background:var(--box-purple)"></span>è—¥ç‰©</div>
        </div>
        <p style="text-align:center; font-size:0.9em; color:#666;">(é»æ“Šæ–¹å¡Šå¯æŸ¥çœ‹ç´°ç¯€)</p>
        
        <div class="flowchart-wrapper">
            <div class="branches" style="padding-top:0;">
                <div class="branch">
                    <div class="node n-start" onclick="toggleNode('d1')">
                        ç–‘ä¼¼ / ç¢ºè¨º CRC
                        <div id="d1" class="details-popover">
                            <ul><li>å¤§è…¸é¡ + åˆ‡ç‰‡</li><li>èƒ¸è…¹éª¨ç›† CT</li><li>CEA</li><li>ç›´è…¸: Pelvic MRI</li><li>è½‰ç§»: RAS/BRAF/MSI</li></ul>
                        </div>
                    </div>
                    <div class="branches">
                        <!-- Branch: Polyp -->
                        <div class="branch">
                            <div class="node n-decision" onclick="toggleNode('d2')">æ—©æœŸç—…ç¶ (Polyp)<div id="d2" class="details-popover">PDF p.7, 18</div></div>
                            <div class="branches"><div class="branch"><div class="node n-action" onclick="toggleNode('d3')">å…§è¦–é¡/ç¶“è‚›åˆ‡é™¤<div id="d3" class="details-popover">Endoscopic / Transanal Excision</div></div>
                                <div class="branches"><div class="branch"><div class="node n-critical" onclick="toggleNode('d4')">é¢¨éšªè©•ä¼° (Risk)<div id="d4" class="details-popover"><strong>High Risk:</strong><br>+Margin, LVI, Poorly diff, SMâ‰¥1mm</div></div></div></div>
                            </div></div>
                        </div>
                        <!-- Branch: Colon -->
                        <div class="branch">
                            <div class="node n-decision">å±€éƒ¨å¤§è…¸ç™Œ</div>
                            <div class="branches"><div class="branch"><div class="node n-action">æ‰‹è¡“åˆ‡é™¤</div>
                                <div class="branches"><div class="branch"><div class="node n-therapy" onclick="toggleNode('d5')">è¼”åŠ©åŒ–ç™‚è©•ä¼°<div id="d5" class="details-popover">Stage III: å»ºè­°åŒ–ç™‚<br>High Risk II: è€ƒæ…®åŒ–ç™‚</div></div></div></div>
                            </div></div>
                        </div>
                        <!-- Branch: Rectal -->
                        <div class="branch">
                            <div class="node n-decision" onclick="toggleNode('d6')">å±€éƒ¨ç›´è…¸ç™Œ<div id="d6" class="details-popover">éœ€åš MRI åˆ¤æ–· CRM</div></div>
                            <div class="branches"><div class="branch"><div class="node n-therapy" onclick="toggleNode('d7')">æ–°è¼”åŠ©æ²»ç™‚ (Neo)<div id="d7" class="details-popover">T3/T4/N+: CCRT or TNT<br>Early: Surgery</div></div>
                                <div class="branches"><div class="branch"><div class="node n-action">TME æ‰‹è¡“</div></div></div>
                            </div></div>
                        </div>
                        <!-- Branch: mCRC -->
                        <div class="branch">
                            <div class="node n-critical" onclick="toggleNode('d8')">è½‰ç§»æ€§ (mCRC)<div id="d8" class="details-popover">PDF p.23-26<br>è«‹åˆ‡æ›è‡³ã€Œç”¨è—¥æ±ºç­–ã€é ç±¤</div></div>
                            <div class="branches">
                                <div class="branch"><div class="node n-action">å¯åˆ‡é™¤: æ‰‹è¡“</div></div>
                                <div class="branch"><div class="node n-therapy">ä¸å¯åˆ‡é™¤: è—¥ç‰©</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 2: mCRC Wizard -->
    <div id="mcrc" class="tab-content">
        <h2>ğŸ§¬ mCRC åŸºå› å°å‘ç”¨è—¥å»ºè­°</h2>
        <p>ä¾æ“š PDF ç¬¬ 23-26 é ï¼Œè«‹è¼¸å…¥æ‚£è€…æª¢æ¸¬çµæœï¼š</p>
        
        <div class="form-group">
            <label>RAS Status (KRAS/NRAS):</label>
            <select id="ras-status">
                <option value="wt">Wild Type (é‡ç”Ÿå‹)</option>
                <option value="mt">Mutant (çªè®Šå‹)</option>
            </select>
        </div>

        <div class="form-group">
            <label>BRAF V600E Status:</label>
            <select id="braf-status">
                <option value="wt">Wild Type</option>
                <option value="mt">Mutation (V600E)</option>
            </select>
        </div>

        <div class="form-group">
            <label>MSI/MMR Status:</label>
            <select id="msi-status">
                <option value="mss">pMMR / MSS (å¾®è¡›æ˜Ÿç©©å®š)</option>
                <option value="msi-h">dMMR / MSI-H (é«˜åº¦ä¸ç©©å®š)</option>
            </select>
        </div>

        <button class="action-btn" onclick="checkTreatment()">å–å¾—å»ºè­°è™•æ–¹</button>

        <div id="result-box">
            <h3>ğŸ’Š å»ºè­°æ²»ç™‚æ–¹æ¡ˆï¼š</h3>
            <div id="treatment-content"></div>
        </div>
    </div>

    <!-- Tab 3: Protocols -->
    <div id="protocols" class="tab-content">
        <h2>ğŸ’Š åŒ–ç™‚/æ¨™é¶è™•æ–¹æŸ¥è©¢</h2>
        <div style="display:flex; gap:10px;">
            <input type="text" id="search-input" placeholder="è¼¸å…¥ä»£ç¢¼ (å¦‚ PCT2025) æˆ–è—¥å (å¦‚ Bev)...">
            <button class="action-btn" style="width:auto; margin-top:0;" onclick="searchProtocol()">æœå°‹</button>
        </div>
        <div id="protocol-result"></div>
    </div>

    <!-- Tab 4: Rectal Info -->
    <div id="rectal" class="tab-content">
        <h2>ğŸ“‹ ç›´è…¸ç™Œè™•ç½®ç°¡è¦ (PDF p.17-20)</h2>
        <div class="form-group" style="background:white; border:1px solid #eee;">
            <h3>ğŸ” MRI Staging æ±ºç­–</h3>
            <ul>
                <li><strong>cT1-2, N0 (CRM-):</strong> ç›´æ¥æ‰‹è¡“ (TME) æˆ–ç¶“è‚›é–€åˆ‡é™¤ã€‚</li>
                <li><strong>Locally Advanced (CRM Involved / T3 / N+):</strong>
                    <ul>
                        <li>å»ºè­° <strong>Neoadjuvant CCRT</strong> (Long course) æˆ– <strong>TNT</strong>ã€‚</li>
                        <li>ç›®æ¨™ï¼šDownsizing / Downstagingã€‚</li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="form-group" style="background:#fff5f5;">
            <h3>âš ï¸ High Risk Features (æ—©æœŸç™Œéœ€æ“´å¤§æ‰‹è¡“)</h3>
            <label><input type="checkbox"> Positive margin (åˆ‡ç·£é™½æ€§)</label>
            <label><input type="checkbox"> Lymphovascular invasion (LVI é™½æ€§)</label>
            <label><input type="checkbox"> Poorly differentiated (åˆ†åŒ–ä¸è‰¯)</label>
            <label><input type="checkbox"> SM invasion â‰¥ 1.0 mm (æ·±å±¤æµ¸æ½¤)</label>
        </div>
    </div>

</div>

<script>
    // --- Data ---
    const protocols = [
        { code: "PCT2025-01", name: "Bevacizumab + mFOLFOX 6", type: "Palliative", status: "å¥ä¿ (äºŒç·š24é€±)", details: "Bevacizumab 5mg/kg + mFOLFOX6 Q2W. (2025æ–°å¢)" },
        { code: "ACT2010-6", name: "mFOLFOX 6", type: "Adjuvant", status: "å¥ä¿ (Stage III)", details: "Oxaliplatin 85mg/m2 + LV + 5-FU bolus + 5-FU infusion (46hr). Q2W x 12 cycles." },
        { code: "ACT2021-01", name: "TEGAFOX", type: "Adjuvant", status: "Oxaliplatinè‡ªè²» + UFT/LVå¥ä¿", details: "Oxaliplatin 85mg/m2 (D1) + UFT/LV PO (D1-5, D8-12). Q2W." },
        { code: "PCT2010-22", name: "Avastin + FOLFIRI", type: "Palliative", status: "æ¨™é¶è‡ªè²» / ä¸€ç·šå¥ä¿", details: "Bevacizumab 5mg/kg + Irinotecan + LV + 5-FU." },
        { code: "PCT2015-02", name: "Panitumumab", type: "Palliative", status: "è‡ªè²»", details: "6mg/kg IVF 60mins Q2W. å–®ç¨æˆ–æ­é…åŒ–ç™‚ (é™ RAS WT)." },
        { code: "PCT2010-5", name: "HIPEC by Oxaliplatin", type: "Palliative", status: "ä¿ç•™ä¸­", details: "è…¹è…”æº«ç†±åŒ–ç™‚ã€‚2025æŒ‡å¼•ç¢ºèªä¿ç•™æ­¤Protocolã€‚" }
    ];

    // --- Logic ---
    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        // Find the button that called this and set active
        const buttons = document.querySelectorAll('.tab-btn');
        if(tabId === 'flowchart') buttons[0].classList.add('active');
        if(tabId === 'mcrc') buttons[1].classList.add('active');
        if(tabId === 'protocols') buttons[2].classList.add('active');
        if(tabId === 'rectal') buttons[3].classList.add('active');
    }

    function toggleNode(id) {
        const el = document.getElementById(id);
        const isShown = el.classList.contains('show');
        // Close all others
        document.querySelectorAll('.details-popover').forEach(p => p.classList.remove('show'));
        // Toggle current
        if (!isShown) el.classList.add('show');
    }

    function checkTreatment() {
        const ras = document.getElementById('ras-status').value;
        const braf = document.getElementById('braf-status').value;
        const msi = document.getElementById('msi-status').value;
        let suggestions = [];

        if (msi === 'msi-h') {
            suggestions.push("âœ… <strong>Immunotherapy (é¦–é¸):</strong> Checkpoint Inhibitors (Pembrolizumab / Nivolumab Â± Ipilimumab) [PDF p.27]");
        }
        if (ras === 'wt' && braf === 'wt') {
            suggestions.push("âœ… <strong>Doublet Chemo + Anti-EGFR:</strong> FOLFOX/FOLFIRI + Cetuximab/Panitumumab (å·¦å´å¤§è…¸å„ªå…ˆ)");
            suggestions.push("âœ… <strong>Doublet Chemo + Bevacizumab:</strong> FOLFOX/FOLFIRI + Bevacizumab");
        } else if (ras === 'mt') {
            suggestions.push("â›” <strong>Anti-EGFR ä¸é©ç”¨</strong> (Cetuximab/Panitumumab ç„¡æ•ˆ)");
            suggestions.push("âœ… <strong>Chemo + Bevacizumab:</strong> FOLFOX/FOLFIRI + Bevacizumab");
            suggestions.push("âœ… <strong>Intensive:</strong> FOLFOXIRI + Bevacizumab (è‹¥é«”èƒ½è¨±å¯)");
        }
        if (braf === 'mt') {
             suggestions.push("âš ï¸ <strong>BRAF V600E Mutation:</strong> é å¾Œè¼ƒå·®");
             suggestions.push("âœ… <strong>First Line:</strong> FOLFOXIRI + Bevacizumab");
             suggestions.push("âœ… <strong>Second/Third Line:</strong> Encorafenib + Cetuximab (Beacon Regimen)");
        }
        if (suggestions.length === 0) suggestions.push("å»ºè­°æ¡è¡Œ Best Supportive Care æˆ–åƒèˆ‡è‡¨åºŠè©¦é©—ã€‚");

        document.getElementById('treatment-content').innerHTML = `<ul>${suggestions.map(s => `<li>${s}</li>`).join('')}</ul>`;
        document.getElementById('result-box').style.display = 'block';
    }

    function searchProtocol() {
        const query = document.getElementById('search-input').value.toLowerCase();
        if(!query) return;
        const results = protocols.filter(p => 
            p.code.toLowerCase().includes(query) || 
            p.name.toLowerCase().includes(query) ||
            p.details.toLowerCase().includes(query)
        );
        const container = document.getElementById('protocol-result');
        container.style.display = 'block';
        if (results.length === 0) {
            container.innerHTML = "<p>æ‰¾ä¸åˆ°ç¬¦åˆçš„è™•æ–¹ã€‚</p>";
            return;
        }
        container.innerHTML = results.map(p => `
            <div class="protocol-card">
                <div class="protocol-title">${p.code} - ${p.name} 
                    <span class="badge ${p.status.includes('è‡ªè²»') ? 'badge-self' : 'badge-ins'}">${p.status}</span>
                </div>
                <div style="font-size:0.9em; margin-top:5px; color:#555;">${p.details}</div>
            </div>
        `).join('');
    }
</script>

</body>
</html>
